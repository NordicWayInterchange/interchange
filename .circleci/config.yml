version: 2.1
jobs:
  build:
    machine: true
    steps:
      - checkout
      - run:
          name: Build the Container
          command: |
            mvn install -Dorg.slf4j.simpleLogger.log.org.apache.maven=warn -B
      - run:
          name: Push containers
          command: |
            echo $GCLOUD_SERVICE_KEY | gcloud auth activate-service-account --key-file=-
            gcloud --quiet config set project ${GOOGLE_PROJECT_ID}
            gcloud --quiet config set compute/zone ${GOOGLE_COMPUTE_ZONE}
            cd interchangenode
            docker build -t interchangenode:${CIRCLE_BRANCH} .
            docker tag interchangenode:${CIRCLE_BRANCH} eu.gcr.io/nordic-way-aad182cc/interchangenode:${CIRCLE_BRANCH}
            gcloud docker -- push eu.gcr.io/nordic-way-aad182cc/interchangenode:${CIRCLE_BRANCH}
