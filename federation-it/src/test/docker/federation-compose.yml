version: '3'
services:

  federation_build:
    build:
      dockerfile: federation-docker-files/Federation_build
      context: ../../../../

  node1_db:
    build:
      dockerfile: Dockerfile
      context: ./client_db
    image: node1_db
    ports:
      - 5432
    environment:
      - POSTGRES_USER=federation
      - POSTGRES_PASSWORD=federation
      - POSTGRES_DB=federation

  server_node1:
    build:
      dockerfile: neighbour-server/Dockerfile
      context: ../../../../
    depends_on:
      - node1_db
      - federation_build
    ports:
      - 8090:8090
    environment:
      - POSTGRES_URI=jdbc:postgresql://node1_db:5432/federation
      - SERVER_NAME=localhost

  node2_db:
    build:
      dockerfile: Dockerfile
      context: ./server_db
    image: node2_db
    ports:
      - 7070:5432
    environment:
      - POSTGRES_USER=federation
      - POSTGRES_PASSWORD=federation
      - POSTGRES_DB=federation

  server_node2:
    build:
      dockerfile: neighbour-server/Dockerfile
      context: ../../../../
    depends_on:
      - node2_db
      - federation_build
    ports:
      - 8070:8090
    environment:
      - POSTGRES_URI=jdbc:postgresql://node2_db:5432/federation
      - SERVER_NAME=bouvet
