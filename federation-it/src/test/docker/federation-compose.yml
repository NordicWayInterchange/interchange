version: '3'
services:

  federation-build:
    build:
      dockerfile: federation-docker-files/Federation_build
      context: ../../../../
    image: federation-build

  server_db:
    build:
      dockerfile: Dockerfile
      context: ./server_db
    image: server_db
    container_name: server_db
    ports:
      - 7080:5432
    environment:
      - POSTGRES_USER=federation
      - POSTGRES_PASSWORD=federation
      - POSTGRES_DB=federation

  server_node1:
    build: ../../../../neighbour-server
    container_name: server_node1
    depends_on:
      - server_db
      - federation-build
    ports:
      - 8090:8090
    environment:
      - POSTGRES_URI=jdbc:postgresql://server_db:5432/federation
      - SERVER_NAME=localhost

  client_db:
    build:
      dockerfile: Dockerfile
      context:  ./client_db
    image: client_db
    container_name: client_db
    ports:
      - 7070:5432
    environment:
      - POSTGRES_USER=federation
      - POSTGRES_PASSWORD=federation
      - POSTGRES_DB=federation

  server_node2:
    build: ../../../../neighbour-server
    container_name: server_node2
    depends_on:
      - client_db
      - federation-build
    ports:
      - 8070:8090
    environment:
      - POSTGRES_URI=jdbc:postgresql://client_db:5432/federation
      - SERVER_NAME=bouvet
